# 技術スタック

## アーキテクチャ

### 高レベルシステム設計
- **Chrome拡張機能アーキテクチャ**: Chrome Extension API v3 (Manifest V3) 上に構築
- **サービスワーカーパターン**: 拡張機能のライフサイクル管理のためのバックグラウンドスクリプトをサービスワーカーとして運用
- **コンテンツスクリプト注入**: DOM操作と自動化のためにWebページに注入されるスクリプト
- **メッセージパッシングシステム**: Chromeランタイムメッセージングを介したポップアップ、バックグラウンド、コンテンツスクリプト間の通信
- **ストレージベース設定**: Chrome Storage APIを使用した設定の永続化

### 拡張機能コンポーネント
- **バックグラウンドスクリプト**: 拡張機能のライフサイクルとスクリプト間メッセージングを処理するサービスワーカー
- **コンテンツスクリプト**: DOM解析とフォーム自動化のためにターゲットWebページに注入
- **ポップアップインターフェース**: ユーザー向けの設定と実行インターフェース
- **マニフェスト設定**: 権限とエントリーポイントを定義するChrome Extension v3マニフェスト

## フロントエンド

### コア技術
- **TypeScript**: 型安全性とモダンES機能を提供する主要開発言語
- **Chrome Extension API**: ストレージ、メッセージング、スクリプト注入のためのネイティブブラウザ拡張機能API
- **DOM API**: Webページ要素とフォームコントロールの直接操作
- **Chrome Storage API**: ブラウザセッション全体での永続設定ストレージ

### UIフレームワーク
- **バニラHTML/CSS/JavaScript**: 標準Web技術で構築されたポップアップインターフェース
- **外部フレームワークなし**: React、Vue、その他の依存関係なしの自己完結実装
- **Chrome拡張機能ポップアップ**: モダンスタイリングを持つネイティブ拡張機能ポップアップウィンドウ

### ビルドシステム
- **Webpack**: モジュールバンドリングとビルドオーケストレーション
- **ts-loader**: Webpackパイプライン内でのTypeScriptコンパイル
- **ES2020ターゲット**: 広範囲ブラウザ互換性を持つモダンJavaScript機能

## 開発環境

### 必要なツール
- **Node.js**: 開発ツール用のJavaScriptランタイム
- **npm**: パッケージ管理とスクリプト実行
- **TypeScriptコンパイラー**: 型チェックとトランスパイル
- **Chromeブラウザー**: テスト用のターゲットランタイム環境
- **Chrome開発者ツール**: 拡張機能のデバッグと開発

### 開発依存関係
- **@types/chrome**: Chrome Extension API用TypeScript定義
- **typescript**: ^5.3.3 - TypeScriptコンパイラーと言語サーバー
- **webpack**: ^5.89.0 - モジュールバンドリングとアセットコンパイル
- **webpack-cli**: ^5.1.4 - Webpack用コマンドラインインターフェース
- **ts-loader**: ^9.5.1 - Webpack用TypeScriptローダー

### TypeScript設定
- **ターゲット**: モダンJavaScript機能用ES2020
- **モジュールシステム**: CommonJS相互運用性を持つES2020モジュール
- **厳格モード**: 完全TypeScript厳格チェック有効
- **ソースマップ**: 開発デバッグサポート
- **宣言ファイル**: API一貫性のための型定義生成

## 一般的なコマンド

### ビルドコマンド
```bash
npm run build    # Webpack最適化による本番ビルド
npm run dev      # アクティブ開発用のウォッチモード付き開発ビルド
npm run watch    # 継続コンパイル用のファイル監視付き開発ビルド
```

### 開発ワークフロー
```bash
# 初期セットアップ
npm install      # すべての依存関係をインストール

# 開発サイクル
npm run dev      # ウォッチ付き開発ビルドを開始
# Chromeで未パッケージ拡張機能を読み込み
# コード変更を行う
# コンテンツ/ポップアップ変更で拡張機能が自動リロード
# バックグラウンドスクリプト変更では手動拡張機能リロードが必要

# 本番デプロイ
npm run build    # 最適化された本番ビルドを作成
```

### Chrome拡張機能開発
- **拡張機能読み込み**: `chrome://extensions/` → デベロッパーモードを有効 → 未パッケージを読み込み
- **ホットリロード**: コンテンツスクリプトとポップアップ変更の自動リロード
- **手動リロード**: バックグラウンドスクリプトとマニフェスト変更に必要
- **デバッグアクセス**: すべての拡張機能コンポーネントでのChrome DevTools統合

## 環境変数

### ビルド環境
- **NODE_ENV**: ビルドモードと最適化レベルを制御
- **Webpackモード**: CLI引数で設定（本番/開発）

### ランタイム設定
- **Chromeストレージ**: すべてのユーザー設定はChromeの同期ストレージに保存
- **外部APIなし**: 外部サービス設定用の環境変数なし
- **ローカル処理**: すべての操作はブラウザコンテキスト内で実行

## ポート設定

### ネットワークサービスなし
- **ローカル動作**: 拡張機能は完全にブラウザコンテキスト内で動作
- **サーバー要件なし**: バックエンドサービスやネットワークポートは不要
- **クライアントサイドのみ**: すべての処理は外部通信なしでブラウザ内で実行

## アーキテクチャパターン

### Chrome拡張機能パターン
- **コンテンツスクリプトパターン**: 分離された実行コンテキストでのWebページへの安全な注入
- **サービスワーカーバックグラウンド**: Chrome Extension API v3によるイベント駆動バックグラウンド処理
- **ストレージファースト設定**: Chromeの内蔵ストレージメカニズムを使用した設定永続化
- **権限ベースアクセス**: 勤怠システム全体での柔軟性のための広範なホスト権限

### DOM相互作用戦略
- **マルチセレクターフォールバック**: 堅牢な要素検出のための複数のセレクターパターン
- **MutationObserver統合**: 動的コンテンツのリアルタイムDOM変更監視
- **イベント駆動更新**: フレームワーク互換性のための適切なフォーム検証イベント発火
- **タイミング制御**: 信頼性の高い自動化のための洗練されたリトライと遅延メカニズム

### セキュリティモデル
- **サンドボックス実行**: コンテンツスクリプトはページスクリプトから分離されたコンテキストで動作
- **権限ベースアクセス**: 各ドメインに明示的なホスト権限が必要
- **外部通信なし**: 外部API呼び出しやデータ送信はゼロ
- **ローカルストレージのみ**: すべてのデータはブラウザの安全なストレージシステム内に残存

### エラーハンドリングアーキテクチャ
- **段階的劣化**: 個々のコンポーネントが失敗した場合でもシステムが動作を継続
- **包括的ログ**: 詳細なエラーレポートと処理ステータス追跡
- **リトライメカニズム**: 指数バックオフによる一時的失敗の自動リトライ
- **ユーザーフィードバック**: 明確なエラーメッセージとトラブルシューティングガイダンス

### パフォーマンス最適化
- **遅延読み込み**: 必要な時のみコンポーネントを読み込み
- **効率的DOMクエリ**: フォールバック付きの最適化されたセレクター戦略
- **メモリ管理**: イベントリスナーとオブザーバーの適切なクリーンアップ
- **ビルド最適化**: 本番バンドル最適化のためのWebpack設定

### セキュリティ考慮事項
- **サンドボックス実行**: コンテンツスクリプトは分離されたコンテキストで動作
- **eval()なし**: セキュリティのための動的コード実行回避
- **入力検証**: すべてのユーザー入力のサニタイズと検証
- **権限境界**: Chromeのセキュリティモデルと権限の尊重